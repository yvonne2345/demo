package main

import (
	"aaa/utils"
	"sync"
)

var (
	WaitGroup sync.WaitGroup
	//sql       = "'2022-07-20 00:00:00','2022-07-20 00:00:00','08:00:27:67:05:3c','08:00:27:ff:ee:23', 4,'192.168.0.222',502,'192.168.0.211',41758,6,'TCP',77, 080027FFEE2308002767053C08004500003F820E4000400635A9C0A800DEC0A800D301F6A31E59F6431C017F6264801800E3B0B100000101080A080AC1B3080AC82D000C000000050003020000,'modbus'----func----'Read_Holding_Registers'----"
	//sql = "'2015-04-01 01:41:35','2015-04-01 01:41:35','00:19:07:24:3c:ca','3c:a9:f4:21:22:f8', 4,'10.1.1.164',44818,'10.1.1.167',5262,6,'TCP',129, 3CA9F42122F8001907243CCA080045000073F258400034063CE00A0101A40A0101A7AF12148E87B046928C05D68550181000F992000063003300000000000000000000000000C1DEBED10000000001000C002D0001000002AF120A0101A4000000000000000001000C003A00040330008E4D52000B313735362D454E42542F4103,'ENIPTCP'----command----'身份列表'----" //enip
	//sql = "'2022-09-01 12:31:47','2022-09-01 12:31:47','00:13:72:97:a2:d4','00:d0:03:b3:a7:fc', 4,'10.4.14.102',58722,'10.130.130.130',9600,17,'UDP',56, 00D003B3A7FC00137297A2D408004500002A828B4000401112CA0A040E660A828282E562258000167DF0C100020000000000007A0C010205,'fins'----comc,respc----'Gain_access','Response timeout'----" //fins
	//sql = "'2022-09-15 14:33:12','2022-09-15 14:33:12','00:50:56:ab:b7:87','00:08:e3:ff:fc:04', 4,'10.131.54.17',54969,'10.131.56.251',4840,6,'TCP',151, 0008E3FFFC04005056ABB7870800450000896BF14000800600000A8336110A8338FBD6B912E85E4F62DB01E9848E50182001848D00004D53474661000000DD318DCD0100000002000000020000000100AC01000080591112B2D9D4010100000000000000FFFFFFFF102700000000001C0000006F70632E7463703A2F2F31302E3133312E35362E3235313A34383430FFFFFFFFFFFFFFFF,'opcua'----serviceId----'GetEndpointsRequest'----" //opcua
	//sql = "'2005-05-12 21:54:47','2005-05-12 21:54:47','00:60:2d:00:15:d5','00:0c:6e:b0:3c:15', 4,'192.168.0.5',47808,'192.168.0.13',47808,17,'UDP',65, 000C6EB03C1500602D0015D5080045000033DF47000040111A10C0A80005C0A8000DBAC0BAC0001FF2FF810A0017010C000D013D0203C90C0C0200006F194C2900,'bacnet'----type,invoke_id,service_choice,obj_instance----'Confirmed-REQ','201','readProperty','111'----"
	//sql = "'2005-05-12 21:36:43','2005-05-12 21:36:43','00:60:2d:00:15:d5','ff:ff:ff:ff:ff:ff', 4,'192.168.0.5',47808,'192.168.0.255',47808,17,'UDP',60, FFFFFFFFFFFF00602D0015D508004500002CDF4000004011192CC0A80005C0A800FFBAC0BAC000182A9D810B00100128FFFF00000D013DFE10087E7E,'bacnet'----type,service_choice----'Unconfirmed-REQ','who-Is'----"
	//sql = "'2005-05-12 21:36:43','2005-05-12 21:36:43','00:60:2d:00:15:d5','ff:ff:ff:ff:ff:ff', 4,'192.168.0.5',47808,'192.168.0.255',47808,17,'UDP',70, FFFFFFFFFFFF00602D0015D5080045000038DF3F000040111921C0A80005C0A800FFBAC0BAC000247551810B001C0128FFFF00000D013DFE1000C40200003D2201E09100212A,'bacnet'----type,service_choice,obj_instance----'Unconfirmed-REQ','i-Am','61'----"
	//sql = "'2015-04-01 01:29:45','2015-04-01 01:29:45','3c:a9:f4:21:22:f8','00:19:07:24:3c:ca', 4,'10.1.1.167',47808,'10.1.1.165',47808,17,'UDP',46, 001907243CCA3CA9F42122F808004500002028B800008011FAC70A0101A70A0101A5BAC0BAC0000CF20081020004,'bvlc'----function----'Read-Broadcast-Distribution-Tab'----"
	//sql = "'2007-09-12 18:18:56','2007-09-12 18:18:56','02:14:4f:23:98:cf','ff:ff:ff:ff:ff:ff', 0,'NULL',0,'NULL',0,255,'NULL',113, FFFFFFFFFFFF02144F2398CF88A461100BF000200100018004000F010007F105003001028004000800050001F205003001028004000800010001F304003001028004000800010001F403003001028004000800010001F502003001028004000800010001F6010030010200040008000100,'ethercat'----cmd,logaddr,offsetaddr----'{LWR,BRD,APRD,APRD,APRD,APRD,APRD}','{12000}','{130,130,130,130,130,130}'"
	//sql = "'2022-07-27 16:08:48','2022-07-27 16:08:48','00:09:91:44:20:17','00:90:27:4e:e3:fc', 4,'10.10.0.129',34964,'10.10.0.150',1566,17,'UDP',310, 0090274EE3FC000991442017080045000128000C00004011648F0A0A00810A0A00968894061E011444C604022800100000000000A0DE976CD111827100010003015A0100A0DE976CD111827100A02442DF7DDBABBAEC1D005443B2500B01630ABAFD0100000001000000000000000500FFFFFFFFBC000000000000000000A80000004080000000000000A80000008009003C0100000A0000000000000000000000000000000000000000000000010000F840000000680000000000000000000000000000000000000000000000000030002C0100000100000000000200000000000100020001000000010003FFFF010A0001FFFF814000010001FFFF814000310018010000010000000000010001FFFF814000010001FFFF814000320018010000010000000000010000000000010001000100000001,'profinet_cm'----operation,pnio_type,block_type,block_index----'Read Implicit','PNIODevice','IODReadReqHeader','I&M0Filter Data'----"
	//sql = "'2022-07-26 15:48:51','2022-07-26 15:48:51','00:0c:29:ba:09:ea','08:00:06:93:cf:32', 0,'NULL',0,'NULL',0,255,'NULL',56, 08000693CF32000C29BA09EA8892FEFD040001000001000000120102000E0001C0A8000AFFFFFF00C0A80001000000000000000000000000,'profinet_dcp'----frame_id,service_id,service_type,dcp_option,dcp_suboption----'get_reset','set','request','allSelector','allSelector'----"
	//sql = "'02:14:4f:23:98:cf','ff:ff:ff:ff:ff:ff',0,0,'0','Ethercat',113,'whitelist reject!','{protocol:Ethercat,type:EtherCAT command,cmd:{LWR,BRD,APRD,APRD,APRD,APRD,APRD,}\",index:\"{226,227,228,229,230,231,232,},logAddr:{12000,},slaveaddr:{5,5,4,3,2,1,},offsetaddr:{130,130,130,130,130,130,}}'" //白名单
	//sql = "alert opcua 10.131.54.17 any -> 10.131.56.251 any (opcua.whitelist:serviceId:{452};msg:opcua whitelist reject!;sid:401;rev:1;)" //白名单
	//sql = "alert modbus 192.168.0.211 41758 -> 192.168.0.222 502 (modbus.whitelist:func:{3}|startaddr:{4990}|endaddr:{4990};msg:\"modbus whitelist reject!\";sid:30011;rev:1;)"
	//sql = "'2022-09-15 18:00:33','2022-09-15 18:00:48','c0:25:a5:8d:51:be','38:f3:ab:da:b3:ea', 4,'192.168.127.248',445,'192.168.127.2',56433,6,'TCP',138, 38F3ABDAB3EAC025A58D51BE08004500007C83E7400040063649C0A87FF8C0A87F0201BDDC711D6711E348987FF650180598703D000000000050FE534D42400001000000000009000100310000000000000004F8040000000000FFFE00000F9F2E47CCD7DFB3000000000000000000000000000000000000000011000000170000000000000000000000,'smb2'----command,FileName----'Write','tw\\test.txt'----"
	sql = "'192.168.1.100','192.168.1.10',49186,44818,'TCP','ENIP-TCP',598,'whitelist reject!','{protocol:ENIP-TCP,command:112,addresstype:161,datatype:177,service:78,(null):178}'"
)

func main() {
	//声明unixsocket
	//us := utils.NewUnixSocket("/data/socket/allow_list_sock")
	//us := utils.NewUnixSocket("/data/socket/obtain_proto_sock")
	us := utils.NewUnixSocket("/data/socket/white_list_warning_sock")
	//发送数据unixsocket并返回服务端处理结果
	//for z := 0; z < 10; z++ {
	//	//循环中启动10个携程
	//	WaitGroup.Add(1)
	//	go func() {
	//		//单个携程循环1000次向unix socket发送执行数据
	//		for i := 0; i < 1000; i++ {
	//			us.ClientSendContext(sql)
	//		}
	//		defer WaitGroup.Done()
	//	}()
	//}
	WaitGroup.Add(1)
	go func() {
		//单个携程循环1000次向unix socket发送执行数据
		for i := 0; i < 1; i++ {
			us.ClientSendContext(sql)
		}
		defer WaitGroup.Done()
	}()
	//挂起等待携程执行完成后结束主线程
	WaitGroup.Wait()
}
